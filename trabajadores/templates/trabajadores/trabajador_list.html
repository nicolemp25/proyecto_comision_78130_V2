{% extends "coder/index.html" %}
{% block titulo %}Trabajadores{% endblock %}

{% block contenido %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Trabajadores</h2>
    <a class="btn btn-primary" href="{% url 'trabajador_create' %}">+ Nuevo trabajador</a>
  </div>

  <!-- Buscador -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-sm-6 col-md-4">
      <input
        class="form-control"
        type="text"
        name="q"
        value="{{ request.GET.q|default:'' }}"
        placeholder="Buscar (nombre, apellido, tienda o RUT)…">
    </div>
    <div class="col-auto">
      <button class="btn btn-primary" type="submit">Buscar</button>
      <a class="btn btn-outline-secondary" href="{% url 'trabajador_list' %}">Limpiar</a>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-sm table-hover align-middle">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>RUT</th>
          <th>Correo</th>
          <th>Tienda</th>
          <th>Fecha ingreso</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for t in trabajadores %}
        <tr>
            <td>
            <a href="{% url 'trabajador_detail' t.rut %}"
                class="text-info me-1 text-decoration-none"
                title="Ver detalle">
                <i class="bi bi-eye"></i>
            </a> {{ t.nombre }}
            </td>
          <td>{{ t.apellido }}</td>
          <td>{{ t.rut }}</td>
          <td><a href="mailto:{{ t.correo }}">{{ t.correo }}</a></td>
          <td>{{ t.tienda }}</td>
          <td>{{ t.fecha_ingreso|date:"d/m/Y" }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-primary" href="{% url 'trabajador_edit' t.rut %}">Editar</a>
            <a class="btn btn-sm btn-outline-danger" href="{% url 'trabajador_delete' t.rut %}">Eliminar</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-muted">
            No se encontraron trabajadores{% if request.GET.q %} para “{{ request.GET.q }}”{% endif %}.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
  <nav aria-label="Paginación">
    <ul class="pagination pagination-sm">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?q={{ request.GET.q }}&page={{ page_obj.previous_page_number }}">Anterior</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Anterior</span></li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">
          Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </span>
      </li>

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?q={{ request.GET.q }}&page={{ page_obj.next_page_number }}">Siguiente</a>
      </li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Siguiente</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}
